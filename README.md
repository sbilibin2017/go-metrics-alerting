# Проект "Go Metrics Alerting"

Этот проект представляет собой простую модульную систему, предназначенную для сбора, обработки и отправки метрик в API для мониторинга и оповещений. Структура проекта позволяет гибко собирать метрики, обновлять их и отправлять на внешний сервис, обеспечивая легко расширяемую архитектуру.

## Структура проекта

Проект разделен на несколько пакетов, каждый из которых отвечает за конкретную часть системы.

### `internal`

Содержит основную бизнес-логику и сервисы проекта.

- **`apiclient`**: Обрабатывает взаимодействие с API, включая отправку данных на внешний сервис.
  - `api_client.go`: Содержит логику работы с клиентом API.
  - `api_client_test.go`: Юнит-тесты для API клиента.

- **`keyprocessor`**: Отвечает за обработку ключей, используемых в системе для работы с метриками или идентификаторами данных.
  - `key_processor.go`: Логика обработки ключей.
  - `key_processor_test.go`: Юнит-тесты для обработки ключей.

- **`metric`**: Содержит логику работы с метриками.
  - `metric_service.go`: Основной сервис, обновляет, отдает метрики.
  - `metric_service_test.go`: Юнит-тесты для сервисов метрик.
  - `value_updater.go`: Логика обновления значений метрик (например, сумма для счетчиков или замена для гейджей).
  - `value_updater_test.go`: Юнит-тесты для обновления значений.

- **`metricagent`**: Управляет сбором и отправкой метрик по расписанию.
  - `metric_agent.go`: Определяет сервис агентов метрик.
  - `metric_agent_test.go`: Юнит-тесты для агентов метрик.
  - `metric_collector.go`: Логика сбора метрик из различных источников.
  - `metric_collector_test.go`: Юнит-тесты для сборщиков метрик.
  - `metric_sender.go`: Отправка метрик на внешний сервис(**`metric`**).
  - `metric_sender_test.go`: Юнит-тесты для отправки метрик.

- **`storage`**: Отвечает за хранение метрик и связанных с ними данных в системе.
  - `repositories/metric.go`: Логика высокого уровня для работы с хранилищем 
  - `repositories/metric_test.go`: Юнит-тесты для работы с хранилищем. 
  - `storage.go`: Логика хранения метрик.
  - `storage_test.go`: Юнит-тесты для хранения метрик.

- **`types`**: Содержит общие типы и константы, используемые в проекте.
  - `constants.go`: Определяет константы, используемые в системе.
  - `metric.go`: Определяет структуры и типы для метрик.

- **`apierror`**: Обрабатывает ошибки API и связанные с ними ответы.
  - `api_error.go`: Определяет типы ошибок и структуры для API ошибок.
  - `api_error_test.go`: Юнит-тесты для обработки ошибок API.

- **`logger`**: Обеспечивает централизованное логирование с использованием библиотеки Logrus.
  - `logger.go`: Логика инициализации и настройки логгера.
  - `logger_test.go`: Юнит-тесты для логгера.

## Диаграмма интерфейсов
![Architecture](docs/architecture.png)


## Описание

- **Сбор метрик**: Периодический сбор метрик из различных источников.
- **Обновление метрик**: Поддержка обновления значений для счетчиков и гейджей.
- **Отправка метрик**: Отправка собранных метрик на внешний сервис для дальнейшей обработки.
- **Обработка ошибок**: Эффективная обработка ошибок API и их логирование.
- **Тестирование**: Юнит-тесты для всех основных компонентов системы, обеспечивающие надежность.


### Инструкция по развертыванию

1. клонировать репозиторий
2. запустить сервер ```go run cmd/server/main.go -a http://localhost:8080```
3. запустить агент ```go run cmd/agent/main.go -a http://localhost:8080 -r 5 -p 3```